// ==UserScript==
// @name         Doc: Create Trade
// @namespace    https://politicsandwar.com/nation/id=19818
// @version      2.6
// @description  Makes script, View Trades, Outbid and Match buttons work.
// @author       BlackAsLight
// @match        https://politicsandwar.com/nation/trade/create/*
// @include      https://politicsandwar.com/index.php?id=27*
// @icon         https://avatars.githubusercontent.com/u/44320105
// @grant        none
// ==/UserScript==
'use strict';
(()=>{function f(t,e=null,...n){if(typeof t!="string")return t(e,...n);let i=document.createElement(t);return e&&Object.entries(e).forEach(([a,o])=>typeof o=="boolean"?i.toggleAttribute(a,o):i.setAttribute(a,o)),n.flat().forEach(async a=>{if(a==null)return;if(a.toString()!=="[object Promise]")return i.append(a);let o=f("div",null);i.append(o),a=await a,o.parentElement&&(o.parentElement.insertBefore(a,o),o.remove())}),i}var d;(function(t){t[t.Money=0]="Money",t[t.Oil=1]="Oil",t[t.Coal=2]="Coal",t[t.Iron=3]="Iron",t[t.Bauxite=4]="Bauxite",t[t.Lead=5]="Lead",t[t.Uranium=6]="Uranium",t[t.Food=7]="Food",t[t.Gasoline=8]="Gasoline",t[t.Steel=9]="Steel",t[t.Aluminum=10]="Aluminum",t[t.Munitions=11]="Munitions",t[t.Credits=12]="Credits"})(d||(d={}));function p(t){return new Promise(e=>setTimeout(()=>e(!0),t))}if(document.querySelector("#Doc_CreateTrade"))throw Error("This script was already injected...");document.body.append(f("div",{id:"Doc_CreateTrade",style:"display: none;"}));var m="Doc_CT1",l="Doc_CT2",u="Doc_CT3",{p:c,q:r,t:s}=Object.fromEntries(location.search.slice(1).split("&").map(t=>t.split("=")).map(([t,e])=>[t,`${parseFloat(e)}`=="NaN"?e:parseFloat(e)]));if(document.querySelector(".alert-success"))if(r&&r>1e6&&localStorage.getItem(l)){localStorage.removeItem(l);let t=location.search.slice(1).split("&"),e=t.findIndex(n=>n.startsWith("q="));t[e]=`q=${r-1e6}`,location.href=location.origin+location.pathname+"?"+t.join("&")}else{let t=document.querySelector("a i.fa-backward").parentElement.href.split("?"),e=t[1].split("&"),n=e.findIndex(i=>i.startsWith("minimum="));n<0?location.href=t.join("?"):(e[n]="minimum=0",location.href=t[0]+"?"+e.join("&"))}else if(document.querySelector("#createTrade")){if(localStorage.removeItem(l),document.querySelector("#createTrade")?.scrollIntoView({behavior:"smooth",block:"center"}),c){let t=document.querySelector("#priceper");t.setAttribute("value",c),t.addEventListener("change",()=>{let e=t.value;parseInt(e)===c?localStorage.removeItem(u):localStorage.setItem(u,e)})}if(r&&document.querySelector("#amount").setAttribute("value",Math.min(r,1e6).toString()),s){let t=(()=>{let n=document.querySelector("button i.fa-hands-usd").parentElement,i=n.nextElementSibling;return(s==="s"?i:n).remove(),s==="s"?n:i})();t.style.setProperty("border-radius","6px"),t.setAttribute("type","submit"),t.setAttribute("name","submit"),t.setAttribute("value",s==="s"?"Sell":"Buy"),t.removeAttribute("data-target");let e=parseInt(localStorage.getItem(m)??"");if(e){let n=5e3+e-new Date().getTime();n>0&&(p(n).then(()=>t.toggleAttribute("disabled",!1)),t.toggleAttribute("disabled",!0)),localStorage.removeItem(m)}r&&r>=1e6&&t.addEventListener("click",()=>{Math.min(r,1e6)===parseInt(document.querySelector("#amount").getAttribute("value")??"")&&(localStorage.setItem(m,`${new Date().getTime()}`),localStorage.setItem(l,"0"))})}}})();
