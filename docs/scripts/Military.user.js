// ==UserScript==
// @name         Doc: Military
// @namespace    https://politicsandwar.com/nation/id=19818
// @version      0.2
// @description  Making it easier to militarise and demilitarise your army.
// @author       BlackAsLight
// @match        https://politicsandwar.com/nation/military/
// @icon         https://avatars.githubusercontent.com/u/44320105
// @grant        none
// ==/UserScript==
'use strict';
function r(t,i){let e=document.createElement(t);return i&&i(e),e}var b={APIKey(t){return localStorage[t===void 0?"getItem":t!==null?"setItem":"removeItem"]("Doc_APIKey",t)}};function h(t){return new Promise(i=>setTimeout(()=>i(!0),t))}function o(){return r("div",t=>t.classList.add("spacer"))}if(document.querySelector("#Doc_Military"))throw Error("This script was already injected...");document.body.append(r("div",t=>{t.setAttribute("id","Doc_Military"),t.style.setProperty("display","none")}));var a=fetch(`https://api.politicsandwar.com/graphql?api_key=${b.APIKey()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"{me{nation{soldiers,soldiers_today,tanks,tanks_today,aircraft,aircraft_today,ships,ships_today,cities{barracks,factory,hangar,drydock}}}}"})}).then(t=>t.json()).then(t=>t.data.me.nation),d=fetch("https://politicsandwar.com/nation/military/soldiers/").then(t=>t.text()).then(t=>new DOMParser().parseFromString(t,"text/html").querySelector('input[name="token"]').value),p=!1;document.head.append(r("style",t=>{t.textContent+=".doc_military { display: grid; grid-template-columns: repeat(2, calc(50% - 0.5rem)); gap: 1rem; }",t.textContent+=".doc_military a { grid-column: 1 / 3; text-align: center; }",t.textContent+=".spacer-row { display: flex; flex-direction: row; align-items: center; }",t.textContent+=".spacer { flex-grow: 1; }"}));r("form",t=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(t,i),i.remove(),t.classList.add("doc_military"),t.append(r("label",e=>{e.classList.add("spacer-row"),e.append("Soldiers Enlisted:",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.soldiers.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Soldiers Enlisted Today:",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.soldiers_today.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Enlist/Discharge:",o(),r("input",n=>{n.setAttribute("type","number"),n.setAttribute("name","soldiers"),n.setAttribute("value","0"),a.then(s=>{let l=s.cities.reduce((u,c)=>u+c.barracks,0)*3e3;n.value=Math.min(Math.round(l/3-s.soldiers_today),l-s.soldiers).toString()})}))}),r("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buysoldiers"),e.setAttribute("value","Enlist/Discharge Soldiers")}),r("input",e=>{e.setAttribute("type","hidden"),e.setAttribute("name","token"),d.then(n=>e.setAttribute("value",n))}),r("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/soldiers/"),e.textContent="Go to Page"})),t.addEventListener("submit",m,{passive:!1}),[...t.querySelectorAll("input")].forEach(e=>e.toggleAttribute("disabled",!0)),a.then(e=>d.then(n=>[...t.querySelectorAll("input")].forEach(s=>s.toggleAttribute("disabled",!1))))});r("form",t=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(t,i),i.remove(),t.classList.add("doc_military"),t.append(r("label",e=>{e.classList.add("spacer-row"),e.append("Tanks Possessed: ",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.tanks.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Tanks Manufactured Today: ",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.tanks_today.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),r("input",n=>{n.setAttribute("type","number"),n.setAttribute("name","tanks"),n.setAttribute("value","0"),a.then(s=>{let l=s.cities.reduce((u,c)=>u+c.factory,0)*250;n.value=Math.min(Math.round(l/5-s.tanks_today),l-s.tanks).toString()})}))}),r("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buytanks"),e.setAttribute("value","Manufacture/Decommission Tanks")}),r("input",e=>{e.setAttribute("type","hidden"),e.setAttribute("name","token"),d.then(n=>e.setAttribute("value",n))}),r("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/tanks/"),e.textContent="Go to Page"})),t.addEventListener("submit",m,{passive:!1}),[...t.querySelectorAll("input")].forEach(e=>e.toggleAttribute("disabled",!0)),a.then(e=>d.then(n=>[...t.querySelectorAll("input")].forEach(s=>s.toggleAttribute("disabled",!1))))});r("form",t=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(t,i),i.remove(),t.classList.add("doc_military"),t.append(r("label",e=>{e.classList.add("spacer-row"),e.append("Aircraft Possessed: ",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.aircraft.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Aircraft Manufactured Today: ",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.aircraft_today.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),r("input",n=>{n.setAttribute("type","number"),n.setAttribute("name","aircraft"),n.setAttribute("value","0"),a.then(s=>{let l=s.cities.reduce((u,c)=>u+c.hangar,0)*15;n.value=Math.min(Math.round(l/5-s.aircraft_today),l-s.aircraft).toString()})}))}),r("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buyaircraft"),e.setAttribute("value","Manufacture/Decommission Aircraft")}),r("input",e=>{e.setAttribute("type","hidden"),e.setAttribute("name","token"),d.then(n=>e.setAttribute("value",n))}),r("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/aircraft/"),e.textContent="Go to Page"})),t.addEventListener("submit",m,{passive:!1}),[...t.querySelectorAll("input")].forEach(e=>e.toggleAttribute("disabled",!0)),a.then(e=>d.then(n=>[...t.querySelectorAll("input")].forEach(s=>s.toggleAttribute("disabled",!1))))});r("form",t=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(t,i),i.remove(),t.classList.add("doc_military"),t.append(r("label",e=>{e.classList.add("spacer-row"),e.append("Ships Possessed: ",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.ships.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Ships Manufactured Today: ",o(),r("span",n=>{n.append("?"),a.then(s=>n.textContent=s.ships_today.toString())}))}),r("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),r("input",n=>{n.setAttribute("type","number"),n.setAttribute("name","ships"),n.setAttribute("value","0"),a.then(s=>{let l=s.cities.reduce((u,c)=>u+c.drydock,0);n.value=Math.min(Math.round(l/5-s.ships_today),l-s.ships).toString()})}))}),r("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buyships"),e.setAttribute("value","Manufacture/Decommission Ships")}),r("input",e=>{e.setAttribute("type","hidden"),e.setAttribute("name","token"),d.then(n=>e.setAttribute("value",n))}),r("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/navy/"),e.textContent="Go to Page"})),t.addEventListener("submit",m,{passive:!1}),[...t.querySelectorAll("input")].forEach(e=>e.toggleAttribute("disabled",!0)),a.then(e=>d.then(n=>[...t.querySelectorAll("input")].forEach(s=>s.toggleAttribute("disabled",!1))))});async function m(t){for(t.preventDefault(),this.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0));p;)await h(50);p=!0;let i=new DOMParser().parseFromString(await(await fetch(this.querySelector("a").href,{method:"POST",body:new FormData(this)})).text(),"text/html").querySelector('input[name="token"]').value;document.querySelectorAll('input[name="token"]').forEach(e=>e.setAttribute("value",i)),p=!1}
