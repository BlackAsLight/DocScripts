// ==UserScript==
// @name         Doc: Nations
// @namespace    https://politicsandwar.com/nation/id=19818
// @version      0.2
// @description  Improves the Nations page UI
// @author       BlackAsLight
// @match        https://politicsandwar.com/nations/
// @include      https://politicsandwar.com/index.php?id=15*
// @icon         https://avatars.githubusercontent.com/u/44320105
// @grant        none
// ==/UserScript==
'use strict';
(()=>{function l(t,o=null,...n){if(typeof t!="string")return t(o,...n);let i=document.createElement(t);return o&&Object.entries(o).forEach(([e,a])=>{a&&i.setAttribute(e,a)}),n.flat().forEach(async e=>{if(e==null)return;if(e.toString()!=="[object Promise]")return i.append(e);let a=l("div",null);i.append(a),e=await e,e!=null&&a.parentElement&&a.parentElement.insertBefore(typeof e=="string"?document.createTextNode(e):e,a),a.remove()}),i}var m;(function(t){t[t.Money=0]="Money",t[t.Oil=1]="Oil",t[t.Coal=2]="Coal",t[t.Iron=3]="Iron",t[t.Bauxite=4]="Bauxite",t[t.Lead=5]="Lead",t[t.Uranium=6]="Uranium",t[t.Food=7]="Food",t[t.Gasoline=8]="Gasoline",t[t.Steel=9]="Steel",t[t.Aluminum=10]="Aluminum",t[t.Munitions=11]="Munitions",t[t.Credits=12]="Credits"})(m||(m={}));var g;(function(t){t[t.Oil=0]="Oil",t[t.Coal=1]="Coal",t[t.Iron=2]="Iron",t[t.Bauxite=3]="Bauxite",t[t.Lead=4]="Lead",t[t.Uranium=5]="Uranium",t[t.Food=6]="Food",t[t.Gasoline=7]="Gasoline",t[t.Steel=8]="Steel",t[t.Aluminum=9]="Aluminum",t[t.Munitions=10]="Munitions",t[t.Credits=11]="Credits"})(g||(g={}));function p(t,o){return o(t),t}if(document.querySelector("#Doc_Nations"))throw Error("This script was already injected...");document.body.append(l("div",{id:"Doc_Nations",style:"display: none;"}));var s="Doc_N1",r="Doc_N2",f=document.querySelector('form[method="GET"]');f.parentElement?.insertBefore(l("div",null,l("label",{for:"Doc_Score"},"Nation Score: "),p(l("input",{id:"Doc_Score",type:"number",value:localStorage.getItem(s)??0}),t=>t.addEventListener("change",o=>{let n=o.target,i=parseFloat(n.value);if(`${i}`=="NaN")return;let e=new Date;n.nextSibling&&(n.nextSibling.textContent=e.toJSON()),localStorage.setItem(r,`${e.getTime()}`),localStorage.setItem(s,`${i}`),d(i)})),l("br",null),new Date(parseInt(localStorage.getItem(r)??"0")).toJSON(),p(l("button",{class:"btn btn-primary",style:"margin-inline: 0.5em;"},"Refresh"),t=>t.addEventListener("click",async o=>{let n=o.target;n.toggleAttribute("disabled",!0);let i=parseFloat(new DOMParser().parseFromString(await(await fetch("https://politicsandwar.com/nation/war/")).text(),"text/html").querySelector("a.btn.btn-warning.btn-lg").href.split("?")[1].split("&").find(a=>a.startsWith("keyword="))?.slice(8)??"0");console.log(`Score: ${i}`);let e=new Date;n.previousSibling&&(n.previousSibling.textContent=e.toJSON()),localStorage.setItem(r,`${e.getTime()}`),localStorage.setItem(s,`${i}`),d(i),n.previousElementSibling.previousElementSibling.value=`${i}`,n.toggleAttribute("disabled",!1)}))),f.nextElementSibling);d(parseFloat(localStorage.getItem(s)??"0"));function u(t,o){return o*.4<=t&&t<=o*2.5}function c(t,o){return o*.75<=t&&t<=o*1.75}function d(t){[...document.querySelectorAll(".nationtable tr")].slice(1).forEach(o=>{let n=o.lastElementChild,i=parseFloat(n.lastChild?.textContent?.replaceAll(",",""));[...n.querySelectorAll("img")].forEach(e=>{e.src!=="https://politicsandwar.com/img/icons/16/plus_shield.png"&&e.remove()}),u(i,t)&&n.insertBefore(l("img",{src:"https://politicsandwar.com/img/icons/16/emotion_spy.png"}),n.lastChild),c(i,t)?c(t,i)?n.insertBefore(l("img",{src:"https://docscripts.stagintin.com/icons/green_red.png"}),n.lastChild):n.insertBefore(l("img",{src:"https://docscripts.stagintin.com/icons/green.png"}),n.lastChild):c(t,i)&&n.insertBefore(l("img",{src:"https://docscripts.stagintin.com/icons/red.png"}),n.lastChild)})}})();
