// ==UserScript==
// @name         Doc: Nations
// @namespace    https://politicsandwar.com/nation/id=19818
// @version      0.2
// @description  Improves the Nations page UI
// @author       BlackAsLight
// @match        https://politicsandwar.com/nations/
// @include      https://politicsandwar.com/index.php?id=15*
// @icon         https://avatars.githubusercontent.com/u/44320105
// @grant        none
// ==/UserScript==
'use strict';
(()=>{function o(t,a=null,...e){if(typeof t!="string")return t(a,...e);let i=document.createElement(t);return a&&Object.entries(a).forEach(([n,r])=>{r&&i.setAttribute(n,r)}),e.flat().forEach(async n=>{if(n==null)return;if(n.toString()!=="[object Promise]")return i.append(n);let r=o("div",null);i.append(r),n=await n,n!=null&&r.parentElement&&r.parentElement.insertBefore(typeof n=="string"?document.createTextNode(n):n,r),r.remove()}),i}var d;(function(t){t[t.Money=0]="Money",t[t.Oil=1]="Oil",t[t.Coal=2]="Coal",t[t.Iron=3]="Iron",t[t.Bauxite=4]="Bauxite",t[t.Lead=5]="Lead",t[t.Uranium=6]="Uranium",t[t.Food=7]="Food",t[t.Gasoline=8]="Gasoline",t[t.Steel=9]="Steel",t[t.Aluminum=10]="Aluminum",t[t.Munitions=11]="Munitions",t[t.Credits=12]="Credits"})(d||(d={}));function m(t,a){return a(t),t}if(document.querySelector("#Doc_Nations"))throw Error("This script was already injected...");document.body.append(o("div",{id:"Doc_Nations",style:"display: none;"}));var l="Doc_N1",s="Doc_N2",p=document.querySelector('form[method="GET"]');p.parentElement?.insertBefore(o("div",null,o("label",{for:"Doc_Score"},"Nation Score: "),m(o("input",{id:"Doc_Score",type:"number",value:localStorage.getItem(l)??0}),t=>t.addEventListener("change",a=>{let e=a.target,i=parseFloat(e.value);if(`${i}`=="NaN")return;let n=new Date;e.nextSibling&&(e.nextSibling.textContent=n.toJSON()),localStorage.setItem(s,`${n.getTime()}`),localStorage.setItem(l,`${i}`),g(i)})),o("br",null),new Date(parseInt(localStorage.getItem(s)??"0")).toJSON(),m(o("button",{class:"btn btn-primary",style:"margin-inline: 0.5em;"},"Refresh"),t=>t.addEventListener("click",async a=>{let e=a.target;e.toggleAttribute("disabled",!0);let i=parseFloat(new DOMParser().parseFromString(await(await fetch("https://politicsandwar.com/nation/war/")).text(),"text/html").querySelector("a.btn.btn-warning.btn-lg").href.split("?")[1].split("&").find(r=>r.startsWith("keyword="))?.slice(8)??"0");console.log(`Score: ${i}`);let n=new Date;e.previousSibling&&(e.previousSibling.textContent=n.toJSON()),localStorage.setItem(s,`${n.getTime()}`),localStorage.setItem(l,`${i}`),g(i),e.previousElementSibling.previousElementSibling.value=`${i}`,e.toggleAttribute("disabled",!1)}))),p.nextElementSibling);g(parseFloat(localStorage.getItem(l)??"0"));function f(t,a){return a*.4<=t&&t<=a*2.5}function c(t,a){return a*.75<=t&&t<=a*1.75}function g(t){[...document.querySelectorAll(".nationtable tr")].slice(1).forEach(a=>{let e=a.lastElementChild,i=parseFloat(e.lastChild?.textContent?.replaceAll(",",""));[...e.querySelectorAll("img")].forEach(n=>{n.src!=="https://politicsandwar.com/img/icons/16/plus_shield.png"&&n.remove()}),f(i,t)&&e.insertBefore(o("img",{src:"https://politicsandwar.com/img/icons/16/emotion_spy.png"}),e.lastChild),c(i,t)?c(t,i)?e.insertBefore(o("img",{src:"https://docscripts.stagintin.com/icons/green_red.png"}),e.lastChild):e.insertBefore(o("img",{src:"https://docscripts.stagintin.com/icons/green.png"}),e.lastChild):c(t,i)&&e.insertBefore(o("img",{src:"https://docscripts.stagintin.com/icons/red.png"}),e.lastChild)})}})();
