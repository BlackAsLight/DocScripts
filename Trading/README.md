# Trading

## Description

### Create Trade

This script runs on the [Create Offer](https://politicsandwar.com/nation/trade/create/) Page, and the unique URLs mentioned in this script are provided by the View Trades Script.

- Auto scrolls the form to the centre of your page.
- Fill out the Quantity and Price of the form **if** it is provided in the URL.
- Hides the Sell/Buy button that is not specified in the URL **if** one is provided in the URL.
- When trades are successfully created, you get auto returned to the [Trades](https://politicsandwar.com/index.php?id=90&display=world&resource1=food&buysell=&ob=price&od=ASC&maximum=100&minimum=0&search=Go) Page that you were last on...
- Unless the Quantity provided in the URL was greater than 1m tons. In which case it will return to the [Create Offer](https://politicsandwar.com/nation/trade/create/) Page, with an adjusted quantity.
  - When you do get returned to the [Create Offer](https://politicsandwar.com/nation/trade/create/) Page, the Sell/Buy button that is still present will be disabled for 5s so you don't run into an error message.
- Format the 'Top Offers' Table to match that of the Sell/Buy buttons and fixes the bad formatting of the tables.

This script requires the View Trades Script for the majority of its functionality to be used.

### View Trade

This script runs on the [Trades](https://politicsandwar.com/index.php?id=90&display=world&resource1=food&buysell=&ob=price&od=ASC&maximum=100&minimum=0&search=Go) Page and is designed to work in tandem with the Create Trade Script.

This script does a lot. On the bottom of the sidebar you'll find some config settings for this script. These settings allow you to change how some aspects of the script work and are:
- Infinite Scroll Toggle: When toggled on this script will load all offers, given the specific search filters, instead of the default 50, or whatever the link you used specified. By default this is toggled off.
- Zero Accountability Toggle: When toggled on this script will affect the quantities in the links of the Outbid, Match, and TopUp buttons, so that they don't take into account your other current offers loaded on the page. By default this is toggled off.
- Max Resource Button: When clicked, you'll be prompted with a box to enter a number in. This number will set a maximum quantity in the links of the Outbid, Match, and TopUp buttons. Providing an invalid number will result in nothing changing, while setting the number to zero or less will result in it being saved as zero. When set to zero, this feature will be disabled and there will be no maximum quantity in the specified links. By default this number is set to zero.
- Min Resource Button: When clicked, you'll be prompted with a box to enter a number in. This number will set a minimum quantity that you do not want to accidentally sell. It will essentally reduce how much the script reads from your resource bar for when calculating the quantity in the Outbid, Match and TopUp buttons, and the trade offer boxes. Providing an invalid number will result in nothing changing, while setting the number to zero or less will result in it being saved as zero. You can also specify a minimum amount for Money by going to your personal trades page or by setting the search fields to "Any Resource". By default this number is set to zero.
> Note: The Max Resource Button and Min Resource Button are not opposites. The Max Resource Button only affects the quantities in the links for Outbid, Match, and TopUp buttons, setting a ceiling to any one given link. Meaning creating any offers will be at max that quantity. The Min Resource Button affects these quantities in these links as well, but by reducing what the script sees you have in your resource by.. Meaning it affects all offers, and not only any given one. The Min Resource Button also affects the quantities calculated and listed in the trade offer boxes. The Zero Accountability Toggle will cause the Min Resource Button to be ignored when calculating the quantities for the Outbid, Match and ToUp buttons, causing the Min Resource Button to only have an affect on the trade offer boxes.
- Market View Options: Allows you to choose between three options, Buy, Sell, and Both. This choice will affect the Market Links injected at the top of the page and the Resource Menu for users with small screens. The choice will set these specific links so when clicked, you'll view what side of the market you like most. By default this is set to Both.

The script also does other stuff besides give you options on the sidebar, which you've probably gathered from reading above as it talked about buttons and links that you've never heard of before. At the very top of the page you'll find:
- When you accept a trade, you might find a Re-Sell/Buy for Profit button on the sucessful accepted trade message. Clicking this button will cause the script to remember this trade and adjust all the opposing trade offer boxes so the quantities in them only sell the desired amount. This button is meant to be clicked after accepting a mistrade, so you can easily re-gain what you lost plus profit. When you accept an opposing offer, the script will automatically subtract that amount and calculate how much profit you just made. If this quantity is greater than the remembered quantity then a  Re-Sell/Buy for Profit button will also be displayed but only for the remaining quantity.
- Market Links are a bunch of prefiltered links to every resource market, your personal trades page, and your activity page since your personal trades page sorts your accepted offers by date created and not date accepted. Market Links also changes the links on the Resource Menu for users with small screens. The activity link is set to a 1000 instead of the default 50 that you'd normally experience when loading that page. Links that end with an asterisk indicate that the script is remembering trades for that resource.
- The trades that the script remembers when clicking said Re-Sell/Buy for Profit button will appear under the Market Links and will list what it remebers. There is a Forget button, which causes the script to forget about that trade, and a Forget All button which will only appear if it's remebering at multiple prices.

The script also does a few things when the page loads, like:
- Mistrade Detection: When viewing both sides of the global market, the script will check to see if any mistrades exist on the page. If it detects one, then it will auto scroll you to it, place a red outline around the offer and temporary switch your game's theme from light to dark or dark to light. It will also adjust the quantity in the smaller offer so you don't risk over extending and buying too much.
> A mistrade is when somebody creates an offer on the market where they're selling resources for less than the current best buy offer, or vice versa.
> 
> E.g. You have an offer on the market buying food for $10/Ton. I then create an offer on the market selling food for $7/Ton. I've just created a mistrade as some third party can come, buy my food, and sell it to you for a $3/Ton.
> 
> A mistrade is when there is money that can be instantly made.
- Auto Scroll: The script will auto scroll you to the top offer when looking at either Buy or Sell markets, or the very center when looking at Both markets. When looking at Both markets, it will also inject a red break block where the Buy and Sell offers switch stating the profit gap between them. If you've accepted a trade successfully, it will first scroll to that message and wait 3s before continuing down. When it scrolls, it will make the element it's scrolling to the center of the page.

Finally the script changing the table itself. The script technically deletes the table and makes it's own, but the details you need to worry about are:
- Firstly, users with small screens may find things in different places. The new table is designed to change as screens get smaller so you no longer have to deal with overflow from the old table.
- The Date of the offer created as had it's format changed to `hh:mm DD/MMM/YYYY`.
- On public trade offers created by other people, you'll find an Outbid and Match button. These buttons leads to the create trade offer page with unqiue links for the Create Trade Script to take over. The Outbid button will have it's price set to $1 better than that current offer, while the Match button will have the exact same price. Clicking these buttons will allow you to easily create a new offer at the desired price of the same type. Type being selling or buying. The quantities in these buttons will be calculated to the max you can afford to buy or sell without creating an error. If Zero Accountability is toggled off then the quantity will take into account other offers that exist on the page, and will remove any min amount, when calculating, set with the Min Resource Button. If the quantity calculated is zero or less then the button will be disabled and a line will be striked through it indicating such. If a max amount is set by the Max Resource Button, then the quantity will cap off at that amount if it calculated a higher value.
- On your personal trade offers, you'll find a TopUp button. This button is essentially just like the Match button for public offers created by other people, but for your own offers.
> Note: Opting to use the Outbid, Match, and TopUp buttons when creating offers instead of the normal method, will provide basic protection against making mistrades. As you won't need to remember what price to set it to, whether to click buy or sell, or forget to change the resource from the default, Food. Once clicked, you only need to decide whether the quantity listed is the one you want to go with, or if you want something less.
- On Accepted offers and Embargo offers, you'll find a Duplicate button. This button will also lead to the create trade offer page with a unquie link. However, this button will be set to match that exact offers price, resource, quantity, and type. It won't take into account whether you can actually duplicate that offer.
- In the trade offer box, that you see on unaccepted offers created by other people, the quantity will be changed from the game default, of the offers amount, and lowered if you can't afford to buy or sell all of that offer. Meaning you don't need to do maths to know how much you can actually afford. When the script calculates this quantity, it does take into account any min amount set by the Min Resource Button. If the script is remembering trades for said resource and side of the market then said quantity may be lowered further, possibly down to zero, so you prioritise re-gaining from the mistrade.
- The Delete buttons on your offers or offers sent personally to you no longer require a refresh. Instead when clicked, the script will proceed to delete the offer in the background and once complete, remove the offer from your screen. Outbid, Match, and TopUp buttons will have their links updated and the quantities in the trade offers boxes will be recalculated.
- The sell buttons on offers will appear green, while the buy offers will appear blue. These colours match the ones of the create trade page.
