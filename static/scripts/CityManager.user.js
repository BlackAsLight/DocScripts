// ==UserScript==
// @name         Doc: City Manager
// @namespace    https://politicsandwar.com/nation/id=19818
// @version      10.0.0
// @description  Improving the experience of switching improvements.
// @author       BlackAsLight
// @match        https://politicsandwar.com/city/id=*
// @icon         https://avatars.githubusercontent.com/u/44320105
// @grant        none
// ==/UserScript==
'use strict';
function r(n){return new Promise(e=>setTimeout(()=>e(!0),n))}async function u(n,e=0){for(;n();)await r(e)}function p(n,e){return e(n),n}function l(n,e){return e(n)}function s(n,e,i){let o=document.createElement(n);if(typeof e=="function")e(o);else if(e){for(let[a,t]of Object.entries(e))t!=null&&(o[a]=t);i&&i(o)}return o}if(document.querySelector("#Doc_CityManager"))throw Error("This script was already injected...");document.body.append(s("div",{id:"Doc_CityManger"},n=>n.style.setProperty("display","none")));var T=document.querySelector('input[name="token"]').value,m=!1;document.querySelectorAll('form[action*="#improvements"]').forEach(n=>n.addEventListener("click",async function(e){if(!e.target||e.target.nodeName!=="INPUT")return;e.preventDefault();let i=e.target;i.toggleAttribute("disabled",!0),await u(()=>m),m=!0;let o=new DOMParser().parseFromString(await(await fetch(this.action,{method:"POST",body:(()=>{let t=new FormData;return t.append(i.name,i.value),t.append("token",T),t})()})).text(),"text/html");T=o.querySelector('input[name="token"]').value,l(i.parentElement,t=>t.nextElementSibling?t.nextElementSibling:t.previousElementSibling).textContent=l(o.querySelector(`input[name="${i.name}"]`).parentElement,t=>t.nextElementSibling?t.nextElementSibling:t.previousElementSibling).textContent;let a=[...document.querySelectorAll(".improvementQuantity")];o.querySelectorAll(".improvementQuantity").forEach((t,f)=>a[f].textContent=t.textContent),document.querySelector("#improvements").insertBefore(o.querySelector("#improvements>span"),p(document.querySelector("#improvements>span"),async t=>{await r(0),t.remove()})),m=!1,i.toggleAttribute("disabled",!1)}));
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vdXRpbHMudHMiLCAiaHR0cHM6Ly9qc3IuaW8vQGRvY3Rvci9jcmVhdGUtdGFnLzAuMi4wL21vZC50cyIsICIuLi8uLi9zcmMvQ2l0eU1hbmFnZXIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8qIFR5cGVzXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmV4cG9ydCB0eXBlIE5vbmUgPSB1bmRlZmluZWQgfCBudWxsO1xuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCB0eXBlIEZvcmNlZCA9IGFueTtcblxuLyogRW51bXNcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGVudW0gUmVzb3VyY2Uge1xuICBNb25leSxcbiAgT2lsLFxuICBDb2FsLFxuICBJcm9uLFxuICBCYXV4aXRlLFxuICBMZWFkLFxuICBVcmFuaXVtLFxuICBGb29kLFxuICBHYXNvbGluZSxcbiAgU3RlZWwsXG4gIEFsdW1pbnVtLFxuICBNdW5pdGlvbnMsXG4gIENyZWRpdHMsXG59XG5cbmV4cG9ydCBlbnVtIE1hcmtldCB7XG4gIE9pbCxcbiAgQ29hbCxcbiAgSXJvbixcbiAgQmF1eGl0ZSxcbiAgTGVhZCxcbiAgVXJhbml1bSxcbiAgRm9vZCxcbiAgR2Fzb2xpbmUsXG4gIFN0ZWVsLFxuICBBbHVtaW51bSxcbiAgTXVuaXRpb25zLFxuICBDcmVkaXRzLFxufVxuXG4vKiBGdW5jdGlvbnNcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGZ1bmN0aW9uIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHRydWU+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPHRydWU+KChhKSA9PiBzZXRUaW1lb3V0KCgpID0+IGEodHJ1ZSksIG1zKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3YWl0VGlsRmFsc2UoXG4gIGZ1bmM6ICgpID0+IGJvb2xlYW4sXG4gIGRlbGF5ID0gMCxcbik6IFByb21pc2U8dm9pZD4ge1xuICB3aGlsZSAoZnVuYygpKSB7XG4gICAgYXdhaXQgc2xlZXAoZGVsYXkpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJNYXA8VCwgVT4oXG4gIGFycmF5OiBUW10sXG4gIGZ1bmM6IChlbGVtZW50OiBULCBpOiBudW1iZXIpID0+IFUgfCBOb25lLFxuKTogVVtdIHtcbiAgY29uc3QgaW5wdXQgPSBbLi4uYXJyYXldO1xuICBjb25zdCBvdXRwdXQ6IFVbXSA9IFtdO1xuICBsZXQgaSA9IDA7XG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiBpbnB1dCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGZ1bmMoZWxlbWVudCwgaSsrKTtcbiAgICBpZiAocmVzdWx0ICE9IHVuZGVmaW5lZCkge1xuICAgICAgb3V0cHV0LnB1c2gocmVzdWx0KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dHB1dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhcGl0YWxpc2UodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGZpbHRlck1hcChcbiAgICB0ZXh0LnNwbGl0KFwiIFwiKSxcbiAgICAod29yZCkgPT5cbiAgICAgIHdvcmRcbiAgICAgICAgPyB3b3JkWzBdLnRvTG9jYWxlVXBwZXJDYXNlKCkgK1xuICAgICAgICAgIHdvcmQuc2xpY2UoMSkudG9Mb2NhbGVMb3dlckNhc2UoKVxuICAgICAgICA6IG51bGwsXG4gICkuam9pbihcIiBcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhYnMoaW50ZWdlcjogYmlnaW50KTogYmlnaW50IHtcbiAgcmV0dXJuIGludGVnZXIgPCAwID8gaW50ZWdlciAqIC0xbiA6IGludGVnZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXgoLi4uaW50ZWdlcnM6IGJpZ2ludFtdKTogYmlnaW50IHtcbiAgbGV0IG1heCA9IGludGVnZXJzLnNoaWZ0KCkgYXMgYmlnaW50O1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGludGVnZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgaWYgKG1heCA8IGludGVnZXJzW2ldKSB7XG4gICAgICBtYXggPSBpbnRlZ2Vyc1tpXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1heDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1pbiguLi5pbnRlZ2VyczogYmlnaW50W10pOiBiaWdpbnQge1xuICBsZXQgbWluID0gaW50ZWdlcnMuc2hpZnQoKSBhcyBiaWdpbnQ7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgaW50ZWdlcnMubGVuZ3RoOyArK2kpIHtcbiAgICBpZiAoaW50ZWdlcnNbaV0gPCBtaW4pIHtcbiAgICAgIG1pbiA9IGludGVnZXJzW2ldO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWluO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3VzTWF4PFQsIFU+KGZ1bmM6ICh2YWx1ZTogVCkgPT4gVSwgLi4udmFsdWVzOiBUW10pOiBUIHtcbiAgbGV0IG1heFZhbHVlID0gdmFsdWVzLnNoaWZ0KCkgYXMgVDtcbiAgbGV0IG1heFJlc3VsdCA9IGZ1bmMobWF4VmFsdWUpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7ICsraSkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGZ1bmModmFsdWVzW2ldKTtcbiAgICBpZiAobWF4UmVzdWx0IDwgcmVzdWx0KSB7XG4gICAgICBtYXhWYWx1ZSA9IHZhbHVlc1tpXTtcbiAgICAgIG1heFJlc3VsdCA9IHJlc3VsdDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1heFZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3VzTWluPFQsIFU+KGZ1bmM6ICh2YWx1ZTogVCkgPT4gVSwgLi4udmFsdWVzOiBUW10pOiBUIHtcbiAgbGV0IG1pblZhbHVlID0gdmFsdWVzLnNoaWZ0KCkgYXMgVDtcbiAgbGV0IG1pblJlc3VsdCA9IGZ1bmMobWluVmFsdWUpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7ICsraSkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGZ1bmModmFsdWVzW2ldKTtcbiAgICBpZiAocmVzdWx0IDwgbWluUmVzdWx0KSB7XG4gICAgICBtaW5WYWx1ZSA9IHZhbHVlc1tpXTtcbiAgICAgIG1pblJlc3VsdCA9IHJlc3VsdDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1pblZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5pcXVlUmFuZG9tSUQoKTogc3RyaW5nIHtcbiAgY29uc3QgY2hhciA9IFwiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpcIjtcbiAgbGV0IGlkOiBzdHJpbmc7XG4gIGRvIHtcbiAgICBpZCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1MDsgKytpKSB7XG4gICAgICBpZCArPSBjaGFyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI2KV07XG4gICAgfVxuICB9IHdoaWxlIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpZH1gKSk7XG4gIHJldHVybiBpZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuZFRpbWUoc3RhcnRUaW1lOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIHJldHVybiAoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyLFxuICB9KSArIFwibXNcIjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhc3NJZlRydXRoeTxUPih4OiBUIHwgTm9uZSwgZnVuYzogKHg6IFQpID0+IHZvaWQpOiBOb25lIHwgVCB7XG4gIGlmICh4KSB7XG4gICAgZnVuYyh4KTtcbiAgfVxuICByZXR1cm4geDtcbn1cblxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCBmdW5jdGlvbiBwYXNzPFQ+KHg6IFQsIGZ1bmM6ICh4OiBUKSA9PiBhbnkpOiBUIHtcbiAgZnVuYyh4KTtcbiAgcmV0dXJuIHg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cmFwPFQsIFU+KHg6IFQsIGZ1bmM6ICh4OiBUKSA9PiBVKTogVSB7XG4gIHJldHVybiBmdW5jKHgpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXR0ZW1wdFByb21pc2U8VCwgVT4oXG4gIGZ1bmM6ICgpID0+IFByb21pc2U8VD4sXG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gIGVycm9yOiAoKGU6IGFueSkgPT4gUHJvbWlzZTxVPikgfCBOb25lID0gdW5kZWZpbmVkLFxuKTogUHJvbWlzZTxUIHwgVSB8IHVuZGVmaW5lZD4ge1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBmdW5jKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZXJyb3IgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gYXdhaXQgZXJyb3IoZSk7XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGVtcHQ8VCwgVT4oXG4gIGZ1bmM6ICgpID0+IFQsXG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gIGVycm9yOiAoKGU6IGFueSkgPT4gVSkgfCBOb25lID0gdW5kZWZpbmVkLFxuKTogVCB8IFUgfCB1bmRlZmluZWQge1xuICB0cnkge1xuICAgIHJldHVybiBmdW5jKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZXJyb3IgIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gZXJyb3IoZSk7XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSA9IG5ldyBEYXRlKCkpOiBzdHJpbmcge1xuICBsZXQgdGV4dCA9IFwiXCI7XG4gIHRleHQgKz0gZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICB0ZXh0ICs9IFwiOlwiO1xuICB0ZXh0ICs9IGRhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICB0ZXh0ICs9IFwiIFwiO1xuICB0ZXh0ICs9IGRhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICB0ZXh0ICs9IFwiL1wiO1xuICB0ZXh0ICs9IFtcbiAgICBcIkphblwiLFxuICAgIFwiRmViXCIsXG4gICAgXCJNYXJcIixcbiAgICBcIkFwclwiLFxuICAgIFwiTWF5XCIsXG4gICAgXCJKdW5cIixcbiAgICBcIkp1bFwiLFxuICAgIFwiQXVnXCIsXG4gICAgXCJTZXBcIixcbiAgICBcIk9jdFwiLFxuICAgIFwiTm92XCIsXG4gICAgXCJEZWNcIixcbiAgXVtkYXRlLmdldE1vbnRoKCldO1xuICB0ZXh0ICs9IFwiL1wiO1xuICB0ZXh0ICs9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgcmV0dXJuIHRleHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyOiBudW1iZXIsIGRpZ2l0cyA9IDIpOiBzdHJpbmcge1xuICByZXR1cm4gbnVtYmVyLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IGRpZ2l0cyB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEJpZ0ludCh4OiBiaWdpbnQpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7KHggLyAxMDBuKS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0pfS4ke1xuICAgICh4ICUgMTAwbikudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIilcbiAgfWA7XG59XG4iLCAiLyoqXG4gKiBAbW9kdWxlXG4gKi9cblxuLyoqXG4gKiBBIHR5cGUgZm9yIGEgZ2l2ZW4gSFRNTEVsZW1lbnQgdGhhdCBmaWx0ZXJzIHRoZSBhdmFpbGFibGUgYXR0cmlidXRlcyB0b1xuICogdmFsdWVzIG9mIHR5cGUgc3RyaW5nLCBudW1iZXIsIG9yIGJvb2xlYW4uXG4gKlxuICogQGV4YW1wbGUgVXNhZ2VcbiAqIGBgYHRzXG4gKiB0eXBlIElucHV0QXR0cmlidXRlcyA9IEF0dHJpYnV0ZXM8J2lucHV0Jz5cbiAqIGBgYFxuICovXG5leHBvcnQgdHlwZSBBdHRyaWJ1dGVzPFQgZXh0ZW5kcyBrZXlvZiBIVE1MRWxlbWVudFRhZ05hbWVNYXA+ID0gUGFydGlhbDxcblx0e1xuXHRcdFtcblx0XHRcdFUgaW4ga2V5b2YgSFRNTEVsZW1lbnRUYWdOYW1lTWFwW1RdIGFzIEhUTUxFbGVtZW50VGFnTmFtZU1hcFtUXVtVXSBleHRlbmRzIHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBudWxsID8gVVxuXHRcdFx0XHQ6IG5ldmVyXG5cdFx0XTogSFRNTEVsZW1lbnRUYWdOYW1lTWFwW1RdW1VdXG5cdH1cbj5cblxuLyoqXG4gKiBBIHR5cGUgc3BlY2lmeWluZyB0aGUgc3RydWN0dXJlIG9mIHRoZSBmdW5jdGlvbiB0aGF0IGNhbiBiZSBwYXNzZWQgdG8gdGhlXG4gKiBjcmVhdGVUYWcgZWxlbWVudC5cbiAqXG4gKiBAZXhhbXBsZSBVc2FnZVxuICogYGBgdHNcbiAqIHR5cGUgSW5wdXRGdW5jID0gRnVuYzwnaW5wdXQnPlxuICogYGBgXG4gKi9cbmV4cG9ydCB0eXBlIEZ1bmM8VCBleHRlbmRzIGtleW9mIEhUTUxFbGVtZW50VGFnTmFtZU1hcD4gPSAodGFnOiBIVE1MRWxlbWVudFRhZ05hbWVNYXBbVF0pID0+IHVua25vd25cblxuLyoqXG4gKiBBIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIEhUTUxFbGVtZW50IHdpdGggdGhlIGNvcnJlY3QgdHlwaW5ncy5cbiAqXG4gKiBAcGFyYW0gdHlwZSBBIHN0cmluZyBjb250YWluaW5nIHRoZSBuYW1lIG9mIHRoZSBIVE1MIGVsZW1lbnQgdG8gYmUgY3JlYXRlZC5cbiAqIEBwYXJhbSBhdHRyaWJ1dGVzIEFuIG9iamVjdCBjb250YWluaW5nIHRoZSBrZXktdmFsdWUgcGFpcnMgb2YgYXR0cmlidXRlcyB0b1xuICogYmUgYXNzaWduZWQgdG8gdGhlIEhUTUwgZWxlbWVudC4gT25seSBzdHJpbmcsIG51bWJlciwgYW5kIGJvb2xlYW4gdmFsdWVzIGFyZVxuICogdmFsaWQuXG4gKiBAcGFyYW0gZnVuYyBBbiBvcHRpb25hbCBmdW5jdGlvbiB0aGF0IHBhc3NlcyB0aGUgY3JlYXRlZCBIVE1MIGVsZW1lbnQgYXMgYVxuICogcGFyYW1ldGVyIGJlZm9yZSByZXNvbHZpbmcgdGhlIGZ1bmN0aW9uLlxuICogQHJldHVybnMgQSBIVE1MIGVsZW1lbnQgYmFzZWQgb2ZmIHdoYXQgd2FzIHNwZWNpZmllZCBpbiB0eXBlLlxuICpcbiAqIEBleGFtcGxlIFVzYWdlXG4gKiBgYGB0c1xuICogY3JlYXRlVGFnKCdidXR0b24nLCB7IHRleHRDb250ZW50OiAnQ2xpY2sgTWUhJyB9LCBidXR0b25UYWcgPT5cbiAqICAgYnV0dG9uVGFnLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKF9ldmVudCkge1xuICogICAgIGNvbnNvbGUubG9nKHRoaXMub3V0ZXJIVE1MKVxuICogICB9KSkuY2xpY2soKVxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUYWc8VCBleHRlbmRzIGtleW9mIEhUTUxFbGVtZW50VGFnTmFtZU1hcD4oXG5cdHR5cGU6IFQsXG5cdGF0dHJpYnV0ZXM6IEF0dHJpYnV0ZXM8VD4sXG5cdGZ1bmM/OiBGdW5jPFQ+LFxuKTogSFRNTEVsZW1lbnRUYWdOYW1lTWFwW1RdXG4vKipcbiAqIEEgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgSFRNTEVsZW1lbnQgd2l0aCB0aGUgY29ycmVjdCB0eXBpbmdzLlxuICpcbiAqIEBwYXJhbSB0eXBlIEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIG5hbWUgb2YgdGhlIEhUTUwgZWxlbWVudCB0byBiZSBjcmVhdGVkLlxuICogQHBhcmFtIGZ1bmMgQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCBwYXNzZXMgdGhlIGNyZWF0ZWQgSFRNTCBlbGVtZW50IGFzIGFcbiAqIHBhcmFtZXRlciBiZWZvcmUgcmVzb2x2aW5nIHRoZSBmdW5jdGlvbi5cbiAqIEByZXR1cm5zIEEgSFRNTCBlbGVtZW50IGJhc2VkIG9mZiB3aGF0IHdhcyBzcGVjaWZpZWQgaW4gdHlwZS5cbiAqXG4gKiBAZXhhbXBsZSBVc2FnZVxuICogYGBgdHNcbiAqIGNyZWF0ZVRhZygnYnV0dG9uJywgYnV0dG9uVGFnID0+XG4gKiAgIGJ1dHRvblRhZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChfZXZlbnQpIHtcbiAqICAgICBjb25zb2xlLmxvZyhcIkkndmUgYmVlbiBjbGlja2VkIVwiKVxuICogICB9KSlcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVGFnPFQgZXh0ZW5kcyBrZXlvZiBIVE1MRWxlbWVudFRhZ05hbWVNYXA+KHR5cGU6IFQsIGZ1bmM/OiBGdW5jPFQ+KTogSFRNTEVsZW1lbnRUYWdOYW1lTWFwW1RdXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVGFnPFQgZXh0ZW5kcyBrZXlvZiBIVE1MRWxlbWVudFRhZ05hbWVNYXA+KFxuXHRhcmcxOiBULFxuXHRhcmcyPzogQXR0cmlidXRlczxUPiB8IEZ1bmM8VD4sXG5cdGFyZzM/OiBGdW5jPFQ+LFxuKTogSFRNTEVsZW1lbnRUYWdOYW1lTWFwW1RdIHtcblx0Y29uc3QgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChhcmcxKVxuXHRpZiAodHlwZW9mIGFyZzIgPT09ICdmdW5jdGlvbicpIHtcblx0XHRhcmcyKHRhZylcblx0fSBlbHNlIGlmIChhcmcyKSB7XG5cdFx0Zm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYXJnMikpIHtcblx0XHRcdGlmICh2YWx1ZSAhPSBudWxsKSB7XG5cdFx0XHRcdHRhZ1trZXkgYXMgJ2lkJ10gPSB2YWx1ZSBhcyBzdHJpbmdcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKGFyZzMpIHtcblx0XHRcdGFyZzModGFnKVxuXHRcdH1cblx0fVxuXHRyZXR1cm4gdGFnXG59XG4iLCAiLy8gPT1Vc2VyU2NyaXB0PT1cbi8vIEBuYW1lICAgICAgICAgRG9jOiBDaXR5IE1hbmFnZXJcbi8vIEBuYW1lc3BhY2UgICAgaHR0cHM6Ly9wb2xpdGljc2FuZHdhci5jb20vbmF0aW9uL2lkPTE5ODE4XG4vLyBAdmVyc2lvbiAgICAgIDEwLjAuMFxuLy8gQGRlc2NyaXB0aW9uICBJbXByb3ZpbmcgdGhlIGV4cGVyaWVuY2Ugb2Ygc3dpdGNoaW5nIGltcHJvdmVtZW50cy5cbi8vIEBhdXRob3IgICAgICAgQmxhY2tBc0xpZ2h0XG4vLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vcG9saXRpY3NhbmR3YXIuY29tL2NpdHkvaWQ9KlxuLy8gQGljb24gICAgICAgICBodHRwczovL2F2YXRhcnMuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3UvNDQzMjAxMDVcbi8vIEBncmFudCAgICAgICAgbm9uZVxuLy8gPT0vVXNlclNjcmlwdD09XG5cbmltcG9ydCB7IHBhc3MsIHNsZWVwLCB3YWl0VGlsRmFsc2UsIHdyYXAgfSBmcm9tIFwiLi4vdXRpbHMudHNcIjtcbmltcG9ydCB7IGNyZWF0ZVRhZyB9IGZyb20gXCJAZG9jdG9yL2NyZWF0ZS10YWdcIjtcblxuLyogRG91YmxlIEluamVjdGlvbiBQcm90ZWN0aW9uXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI0RvY19DaXR5TWFuYWdlclwiKSkge1xuICB0aHJvdyBFcnJvcihcIlRoaXMgc2NyaXB0IHdhcyBhbHJlYWR5IGluamVjdGVkLi4uXCIpO1xufVxuZG9jdW1lbnQuYm9keS5hcHBlbmQoXG4gIGNyZWF0ZVRhZyhcbiAgICBcImRpdlwiLFxuICAgIHsgaWQ6IFwiRG9jX0NpdHlNYW5nZXJcIiB9LFxuICAgIChkaXZUYWcpID0+IGRpdlRhZy5zdHlsZS5zZXRQcm9wZXJ0eShcImRpc3BsYXlcIiwgXCJub25lXCIpLFxuICApLFxuKTtcblxuLyogR2xvYmFsIFZhcmlhYmxlc1xuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5sZXQgdG9rZW4gPVxuICAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cInRva2VuXCJdJykgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWU7XG5sZXQgc3VibWl0dGluZyA9IGZhbHNlO1xuLyogTWFpblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdmb3JtW2FjdGlvbio9XCIjaW1wcm92ZW1lbnRzXCJdJylcbiAgLmZvckVhY2goKGZvcm1UYWcpID0+XG4gICAgKGZvcm1UYWcgYXMgSFRNTEZvcm1FbGVtZW50KVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyBmdW5jdGlvbiAoZXZlbnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFldmVudC50YXJnZXQgfHxcbiAgICAgICAgICAoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5ub2RlTmFtZSAhPT0gXCJJTlBVVFwiXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnN0IGlucHV0VGFnID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlucHV0VGFnLnRvZ2dsZUF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICBhd2FpdCB3YWl0VGlsRmFsc2UoKCkgPT4gc3VibWl0dGluZyk7XG4gICAgICAgIHN1Ym1pdHRpbmcgPSB0cnVlO1xuXG4gICAgICAgIGNvbnN0IGRvbSA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoXG4gICAgICAgICAgYXdhaXQgKGF3YWl0IGZldGNoKHRoaXMuYWN0aW9uLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgYm9keTogKCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGlucHV0VGFnLm5hbWUsIGlucHV0VGFnLnZhbHVlKTtcbiAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwidG9rZW5cIiwgdG9rZW4pO1xuICAgICAgICAgICAgICByZXR1cm4gZm9ybURhdGE7XG4gICAgICAgICAgICB9KSgpLFxuICAgICAgICAgIH0pKS50ZXh0KCksXG4gICAgICAgICAgXCJ0ZXh0L2h0bWxcIixcbiAgICAgICAgKTtcbiAgICAgICAgdG9rZW4gPSAoZG9tLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgJ2lucHV0W25hbWU9XCJ0b2tlblwiXScsXG4gICAgICAgICkgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWU7XG4gICAgICAgIHdyYXAoaW5wdXRUYWcucGFyZW50RWxlbWVudCBhcyBIVE1MUGFyYWdyYXBoRWxlbWVudCwgKHBUYWcpID0+XG4gICAgICAgICAgKHBUYWcubmV4dEVsZW1lbnRTaWJsaW5nXG4gICAgICAgICAgICA/IHBUYWcubmV4dEVsZW1lbnRTaWJsaW5nXG4gICAgICAgICAgICA6IHBUYWcucHJldmlvdXNFbGVtZW50U2libGluZykgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQpXG4gICAgICAgICAgLnRleHRDb250ZW50ID0gd3JhcChcbiAgICAgICAgICAgIChkb20ucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgYGlucHV0W25hbWU9XCIke2lucHV0VGFnLm5hbWV9XCJdYCxcbiAgICAgICAgICAgICkgYXMgSFRNTElucHV0RWxlbWVudClcbiAgICAgICAgICAgICAgLnBhcmVudEVsZW1lbnQgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQsXG4gICAgICAgICAgICAocFRhZykgPT5cbiAgICAgICAgICAgICAgKHBUYWcubmV4dEVsZW1lbnRTaWJsaW5nID8gcFRhZy5uZXh0RWxlbWVudFNpYmxpbmcgOiBwVGFnXG4gICAgICAgICAgICAgICAgLnByZXZpb3VzRWxlbWVudFNpYmxpbmcpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50LFxuICAgICAgICAgICkudGV4dENvbnRlbnQ7XG4gICAgICAgIGNvbnN0IHNwYW5UYWdzID0gW1xuICAgICAgICAgIC4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaW1wcm92ZW1lbnRRdWFudGl0eVwiKSxcbiAgICAgICAgXTtcbiAgICAgICAgZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaW1wcm92ZW1lbnRRdWFudGl0eVwiKS5mb3JFYWNoKChcbiAgICAgICAgICBzcGFuVGFnLFxuICAgICAgICAgIGksXG4gICAgICAgICkgPT5cbiAgICAgICAgICBzcGFuVGFnc1tpXS50ZXh0Q29udGVudCA9IHNwYW5UYWcudGV4dENvbnRlbnRcbiAgICAgICAgKTtcbiAgICAgICAgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgXCIjaW1wcm92ZW1lbnRzXCIsXG4gICAgICAgICkgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQpLmluc2VydEJlZm9yZShcbiAgICAgICAgICBkb20ucXVlcnlTZWxlY3RvcihcIiNpbXByb3ZlbWVudHM+c3BhblwiKSBhcyBIVE1MU3BhbkVsZW1lbnQsXG4gICAgICAgICAgcGFzcyhcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgIFwiI2ltcHJvdmVtZW50cz5zcGFuXCIsXG4gICAgICAgICAgICApIGFzIEhUTUxTcGFuRWxlbWVudCxcbiAgICAgICAgICAgIGFzeW5jIChzcGFuVGFnKSA9PiB7XG4gICAgICAgICAgICAgIGF3YWl0IHNsZWVwKDApO1xuICAgICAgICAgICAgICBzcGFuVGFnLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICApLFxuICAgICAgICApO1xuXG4gICAgICAgIHN1Ym1pdHRpbmcgPSBmYWxzZTtcbiAgICAgICAgaW5wdXRUYWcudG9nZ2xlQXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgfSlcbiAgKTtcbiJdLAogICJtYXBwaW5ncyI6ICJBQXlDTyxTQUFTQSxFQUFNQyxFQUEyQixDQUMvQyxPQUFPLElBQUksUUFBZUMsR0FBTSxXQUFXLElBQU1BLEVBQUUsRUFBSSxFQUFHRCxDQUFFLENBQUMsQ0FDL0QsQ0FFQSxlQUFzQkUsRUFDcEJDLEVBQ0FDLEVBQVEsRUFDTyxDQUNmLEtBQU9ELEVBQUssR0FDVixNQUFNSixFQUFNSyxDQUFLLENBRXJCLENBMEdPLFNBQVNDLEVBQVFDLEVBQU1DLEVBQXdCLENBQ3BELE9BQUFBLEVBQUtELENBQUMsRUFDQ0EsQ0FDVCxDQUVPLFNBQVNFLEVBQVdGLEVBQU1DLEVBQXNCLENBQ3JELE9BQU9BLEVBQUtELENBQUMsQ0FDZixDQzNGTyxTQUFTRyxFQUNmQyxFQUNBQyxFQUNBQyxFQUMyQixDQUMzQixJQUFNQyxFQUFNLFNBQVMsY0FBY0gsQ0FBSSxFQUN2QyxHQUFJLE9BQU9DLEdBQVMsV0FDbkJBLEVBQUtFLENBQUcsVUFDRUYsRUFBTSxDQUNoQixPQUFXLENBQUNHLEVBQUtDLENBQUssSUFBSyxPQUFPLFFBQVFKLENBQUksRUFDekNJLEdBQVMsT0FDWkYsRUFBSUMsQ0FBVyxFQUFJQyxHQUdqQkgsR0FDSEEsRUFBS0MsQ0FBRyxDQUVWLENBQ0EsT0FBT0EsQ0FDUixDQzdFQSxHQUFJLFNBQVMsY0FBYyxrQkFBa0IsRUFDM0MsTUFBTSxNQUFNLHFDQUFxQyxFQUVuRCxTQUFTLEtBQUssT0FDWkcsRUFDRSxNQUNBLENBQUUsR0FBSSxnQkFBaUIsRUFDdEJDLEdBQVdBLEVBQU8sTUFBTSxZQUFZLFVBQVcsTUFBTSxDQUN4RCxDQUNGLEVBSUEsSUFBSUMsRUFDRCxTQUFTLGNBQWMscUJBQXFCLEVBQXVCLE1BQ2xFQyxFQUFhLEdBR2pCLFNBQVMsaUJBQWlCLCtCQUErQixFQUN0RCxRQUFTQyxHQUNQQSxFQUNFLGlCQUFpQixRQUFTLGVBQWdCQyxFQUFzQixDQUMvRCxHQUNFLENBQUNBLEVBQU0sUUFDTkEsRUFBTSxPQUF1QixXQUFhLFFBRTNDLE9BRUZBLEVBQU0sZUFBZSxFQUVyQixJQUFNQyxFQUFXRCxFQUFNLE9BQ3ZCQyxFQUFTLGdCQUFnQixXQUFZLEVBQUksRUFDekMsTUFBTUMsRUFBYSxJQUFNSixDQUFVLEVBQ25DQSxFQUFhLEdBRWIsSUFBTUssRUFBTSxJQUFJLFVBQVUsRUFBRSxnQkFDMUIsTUFBTyxNQUFNLE1BQU0sS0FBSyxPQUFRLENBQzlCLE9BQVEsT0FDUixNQUFPLElBQU0sQ0FDWCxJQUFNQyxFQUFXLElBQUksU0FDckIsT0FBQUEsRUFBUyxPQUFPSCxFQUFTLEtBQU1BLEVBQVMsS0FBSyxFQUM3Q0csRUFBUyxPQUFPLFFBQVNQLENBQUssRUFDdkJPLENBQ1QsR0FBRyxDQUNMLENBQUMsR0FBRyxLQUFLLEVBQ1QsV0FDRixFQUNBUCxFQUFTTSxFQUFJLGNBQ1gscUJBQ0YsRUFBdUIsTUFDdkJFLEVBQUtKLEVBQVMsY0FBd0NLLEdBQ25EQSxFQUFLLG1CQUNGQSxFQUFLLG1CQUNMQSxFQUFLLHNCQUErQyxFQUN2RCxZQUFjRCxFQUNaRixFQUFJLGNBQ0gsZUFBZUYsRUFBUyxJQUFJLElBQzlCLEVBQ0csY0FDRkssR0FDRUEsRUFBSyxtQkFBcUJBLEVBQUssbUJBQXFCQSxFQUNsRCxzQkFDUCxFQUFFLFlBQ0osSUFBTUMsRUFBVyxDQUNmLEdBQUcsU0FBUyxpQkFBaUIsc0JBQXNCLENBQ3JELEVBQ0FKLEVBQUksaUJBQWlCLHNCQUFzQixFQUFFLFFBQVEsQ0FDbkRLLEVBQ0FDLElBRUFGLEVBQVNFLENBQUMsRUFBRSxZQUFjRCxFQUFRLFdBQ3BDLEVBQ0MsU0FBUyxjQUNSLGVBQ0YsRUFBMkIsYUFDekJMLEVBQUksY0FBYyxvQkFBb0IsRUFDdENPLEVBQ0UsU0FBUyxjQUNQLG9CQUNGLEVBQ0EsTUFBT0YsR0FBWSxDQUNqQixNQUFNRyxFQUFNLENBQUMsRUFDYkgsRUFBUSxPQUFPLENBQ2pCLENBQ0YsQ0FDRixFQUVBVixFQUFhLEdBQ2JHLEVBQVMsZ0JBQWdCLFdBQVksRUFBSyxDQUM1QyxDQUFDLENBQ0wiLAogICJuYW1lcyI6IFsic2xlZXAiLCAibXMiLCAiYSIsICJ3YWl0VGlsRmFsc2UiLCAiZnVuYyIsICJkZWxheSIsICJwYXNzIiwgIngiLCAiZnVuYyIsICJ3cmFwIiwgImNyZWF0ZVRhZyIsICJhcmcxIiwgImFyZzIiLCAiYXJnMyIsICJ0YWciLCAia2V5IiwgInZhbHVlIiwgImNyZWF0ZVRhZyIsICJkaXZUYWciLCAidG9rZW4iLCAic3VibWl0dGluZyIsICJmb3JtVGFnIiwgImV2ZW50IiwgImlucHV0VGFnIiwgIndhaXRUaWxGYWxzZSIsICJkb20iLCAiZm9ybURhdGEiLCAid3JhcCIsICJwVGFnIiwgInNwYW5UYWdzIiwgInNwYW5UYWciLCAiaSIsICJwYXNzIiwgInNsZWVwIl0KfQo=
