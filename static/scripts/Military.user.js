// ==UserScript==
// @name         Doc: Military
// @namespace    https://politicsandwar.com/nation/id=19818
// @version      10.0.1
// @description  Making it easier to militarise and demilitarise your army.
// @author       BlackAsLight
// @match        https://politicsandwar.com/nation/military/
// @icon         https://avatars.githubusercontent.com/u/44320105
// @grant        none
// ==/UserScript==
'use strict';
var m=function(n){return localStorage[n===void 0?"getItem":n!==null?"setItem":"removeItem"]("Doc_APIKey",n)};function s(n,i,e){let t=document.createElement(n);if(typeof i=="function")i(t);else if(i){for(let[r,l]of Object.entries(i))l!=null&&(t[r]=l);e&&e(t)}return t}var b={};async function f(n,i){for(;b[n];)await y(50);b[n]=!0;try{return await i()}catch(e){throw e}finally{delete b[n]}}function y(n){return new Promise(i=>setTimeout(()=>i(!0),n))}function o(){return s("div",n=>n.classList.add("spacer"))}function A(){return document.querySelector("#Doc_Config")??s("div",n=>{document.querySelector("#leftcolumn").append(n),n.setAttribute("id","Doc_Config")})}function _(n){let i=A();i.append(document.createElement("hr")),i.append(s("b",e=>e.append(n)))}function S(){let n=A();n.append(document.createElement("br")),n.append(s("button",i=>{let e=m();i.append(e?"Update API Key":"Insert API Key"),i.addEventListener("click",t=>{let r=prompt("Insert API Key | It can be found at the bottom of the Accounts Page:",e??"");r!==null&&(m(r||null),location.reload())})}))}function u(n){return f("Doc_Token",async()=>{let i=sessionStorage.getItem("Doc_Token")??document.querySelector('input[name="token"]')?.value;if(i==null){let t,r;for(;;){if(t=await fetch("https://politicsandwar.com/city/"),t.status!==200)throw`Failed to get Token | Status Code: ${t.status}`;if(r=new DOMParser().parseFromString(await t.text(),"text/html"),i=r.querySelector('input[name="token"]')?.value,i)break;if(r.querySelector('img[alt="Politics & Snore"]'))await y(5e3);else throw"Failed to get Token | Token not Found"}}let e=await n(i);if(e!==void 0){if(e===null)return sessionStorage.removeItem("Doc_Token");sessionStorage.setItem("Doc_Token",e)}})}if(document.querySelector("#Doc_Military"))throw Error("This script was already injected...");document.body.append(s("div",{id:"Doc_Military"},n=>n.style.setProperty("display","none")));var a=fetch(`https://api.politicsandwar.com/graphql?api_key=${m()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"{me{nation{soldiers,soldiers_today,tanks,tanks_today,aircraft,aircraft_today,ships,ships_today,spies,spies_today,missiles,missiles_today,nukes,nukes_today,cities{barracks,factory,hangar,drydock},propaganda_bureau,central_intelligence_agency,spy_satellite,missile_launch_pad,space_program,nuclear_research_facility}}}"})}).then(n=>n.json()).then(n=>n.data.me.nation);_("Military");S();document.head.append(s("style",n=>{n.textContent+=".doc_military { display: grid; grid-template-columns: repeat(2, calc(50% - 0.5rem)); gap: 1rem; }",n.textContent+=".doc_military a { grid-column: 1 / 3; text-align: center; }",n.textContent+=".spacer-row { display: flex; flex-direction: row; align-items: center; }",n.textContent+=".spacer { flex-grow: 1; }",n.append("#Doc_Config { text-align: center; padding: 0 1em; font-size: 0.8em; }"),n.append("#Doc_Config b { font-size: 1.25em; }"),n.append("#Doc_Config button { font-size: inherit; font-weight: normal; padding: 0; }"),n.append("#Doc_Config hr { margin: 0.5em 0; }")}));s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Soldiers Enlisted:",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.soldiers.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Soldiers Enlisted Today:",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.soldiers_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Enlist/Discharge:",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","soldiers"),t.setAttribute("value","0"),a.then(r=>{let l=r.cities.reduce((d,c)=>d+c.barracks,0)*3e3;t.value=Math.min(Math.round(l/3*(r.propaganda_bureau?1.1:1)-r.soldiers_today),l-r.soldiers).toString()})}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buysoldiers"),e.setAttribute("value","Enlist/Discharge Soldiers")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/soldiers/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),Promise.all([a,u(()=>{})]).then(e=>n.querySelectorAll("input").forEach(t=>t.toggleAttribute("disabled",!1)))});s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Tanks Possessed: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.tanks.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Tanks Manufactured Today: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.tanks_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","tanks"),t.setAttribute("value","0"),a.then(r=>{let l=r.cities.reduce((d,c)=>d+c.factory,0)*250;t.value=Math.min(Math.round(l/5*(r.propaganda_bureau?1.1:1)-r.tanks_today),l-r.tanks).toString()})}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buytanks"),e.setAttribute("value","Manufacture/Decommission Tanks")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/tanks/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),Promise.all([a,u(()=>{})]).then(e=>n.querySelectorAll("input").forEach(t=>t.toggleAttribute("disabled",!1)))});s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Aircraft Possessed: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.aircraft.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Aircraft Manufactured Today: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.aircraft_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","aircraft"),t.setAttribute("value","0"),a.then(r=>{let l=r.cities.reduce((d,c)=>d+c.hangar,0)*15;t.value=Math.min(Math.round(l/5*(r.propaganda_bureau?1.1:1)-r.aircraft_today),l-r.aircraft).toString()})}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buyaircraft"),e.setAttribute("value","Manufacture/Decommission Aircraft")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/aircraft/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),Promise.all([a,u(()=>{})]).then(e=>n.querySelectorAll("input").forEach(t=>t.toggleAttribute("disabled",!1)))});s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Ships Possessed: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.ships.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Ships Manufactured Today: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.ships_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","ships"),t.setAttribute("value","0"),a.then(r=>{let l=r.cities.reduce((d,c)=>d+c.drydock,0)*5;t.value=Math.min(Math.round(l/5*(r.propaganda_bureau?1.1:1)-r.ships_today),l-r.ships).toString()})}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buyships"),e.setAttribute("value","Manufacture/Decommission Ships")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/navy/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),Promise.all([a,u(()=>{})]).then(()=>n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!1)))});s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Spies Enlisted: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.spies.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Spies Enlisted Today: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.spies_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Enlist/Discharge: ",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","spies"),t.setAttribute("value","0"),a.then(r=>t.value=Math.min((r.central_intelligence_agency?3:2)+(r.spy_satellite?1:0)-r.spies_today,(r.central_intelligence_agency?60:50)-r.spies).toString())}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","train_spies"),e.setAttribute("value","Enlist/Discharge Spies")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/spies/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),Promise.all([a,u(()=>{})]).then(()=>n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!1)))});s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Missiles Stockpiled: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.missiles.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Missiles Manufactured Today: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.missiles_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","missile_purchase_input_amount"),t.setAttribute("value","0"),a.then(r=>t.value=((r.space_program?3:2)-r.missiles_today).toString())}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","missile_purchase_form_submit"),e.setAttribute("value","Manufacture/Decommission Missiles")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/missiles/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),a.then(async e=>{e.missile_launch_pad&&(await u(()=>{}),n.querySelectorAll("input").forEach(t=>t.toggleAttribute("disabled",!1)))})});s("form",n=>{let i=document.querySelector("#rightcolumn>.row");i.parentElement.insertBefore(n,i),i.remove(),n.classList.add("doc_military"),n.append(s("label",e=>{e.classList.add("spacer-row"),e.append("Nuclear Weapons Possessed: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.nukes.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Nuclear Weapons Manufactured Today: ",o(),s("span",t=>{t.append("?"),a.then(r=>t.textContent=r.nukes_today.toString())}))}),s("label",e=>{e.classList.add("spacer-row"),e.append("Manufacture/Decommission: ",o(),s("input",t=>{t.setAttribute("type","number"),t.setAttribute("name","ships"),t.setAttribute("value","0"),a.then(r=>t.value=(1-r.nukes_today).toString())}))}),s("input",e=>{e.setAttribute("type","submit"),e.setAttribute("name","buyships"),e.setAttribute("value","Manufacture/Decommission Nuclear Weapons")}),s("a",e=>{e.setAttribute("href","https://politicsandwar.com/nation/military/nukes/"),e.textContent="Go to Page"})),n.addEventListener("submit",p,{passive:!1}),n.querySelectorAll("input").forEach(e=>e.toggleAttribute("disabled",!0)),a.then(async e=>{e.nuclear_research_facility&&(await u(()=>{}),n.querySelectorAll("input").forEach(t=>t.toggleAttribute("disabled",!1)))})});async function p(n){n.preventDefault(),this.querySelectorAll("input").forEach(i=>i.toggleAttribute("disabled",!0)),await u(async i=>new DOMParser().parseFromString(await(await fetch(this.querySelector("a").href,{method:"POST",body:[...this.querySelectorAll("input[name][value]"),{name:"token",value:i}].reduce((e,t)=>(e.append(t.name,t.value),e),new FormData)})).text(),"text/html").querySelector('input[name="token"]')?.value??null),this.querySelector('input[type="number"]').value="0",this.querySelectorAll("input").forEach(i=>i.toggleAttribute("disabled",!1))}
